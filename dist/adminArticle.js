(self.webpackChunkblog=self.webpackChunkblog||[]).push([[734],{4263:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w}),n(6301);var r=n(6783),a=(n(6583),n(1011)),i=(n(9139),n(9650)),o=(n(3375),n(331)),l=(n(160),n(1577)),c=(n(6669),n(5026)),s=(n(9889),n(7751)),u=n(7294),d=n(9711),m=n(4259),f=n.n(m),p=n(9101),g=n(1876);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function b(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}var S=s.Z.Column,w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(k,e);var t,n,m,h,w=(m=k,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=A(m);if(h){var n=A(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function k(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,k),(t=w.call(this,e)).getArticles=t.getArticles.bind(E(t)),t.setForm=t.setForm.bind(E(t)),t.updateArticle=t.updateArticle.bind(E(t)),t.deleteArticle=t.deleteArticle.bind(E(t)),t.changeOnlineStatus=t.changeOnlineStatus.bind(E(t)),t.state={articleData:[],formVisible:!1,articleTitle:"",articleId:"",articleTag:"",method:"no method"},t}return t=k,(n=[{key:"changeOnlineStatus",value:function(e,t){var n=this;g.Z.put("/admin/article",{articleId:e,online:!t}).then((function(e){c.ZP.success("更新状态成功"),n.getArticles()}))}},{key:"deleteArticle",value:function(e){var t=this;console.log("deleteArticle toggled",e),g.Z.delete("admin/article",{data:{articleId:e}}).then((function(e){t.getArticles(),c.ZP.success("文章删除成功")}))}},{key:"getArticles",value:function(){var e=this;console.log("get Articles"),g.Z.get("/admin/article").then((function(t){for(var n=0;n<t.data.length;n++)t.data[n].key=t.data[n]._id;console.log(t.data),t.data.sort((function(e,t){return t.created-e.created})),e.setState({articleData:t.data})}))}},{key:"setForm",value:function(e){console.log("new Article",e),this.setState({formVisible:!0});var t=void 0===e?"POST":"PUT";this.setState({method:t}),console.log(t),"POST"===t?this.setState({articleTitle:"",articleTag:""}):"PUT"===t&&this.setState({articleTitle:e.articleTitle,articleTag:e.articleTag,articleId:e.articleId}),console.log(this.state.form)}},{key:"updateArticle",value:function(){var e=this;console.log("updateArticle"),this.setState({formVisible:!1}),console.log(this.state.method),(0,g.Z)({url:"admin/article",method:this.state.method,data:{articleTitle:this.state.articleTitle,articleId:this.state.articleId,tag:this.state.articleTag}}).then((function(t){console.log(t),e.getArticles(),c.ZP.success("文章操作成功")}))}},{key:"componentDidMount",value:function(){this.getArticles()}},{key:"render",value:function(){var e=this;return u.createElement("div",{className:f().container},u.createElement("div",null),u.createElement("div",{className:f().header},u.createElement(l.Z,{className:f().newArticle,icon:u.createElement(p.Z,null),onClick:function(){return e.setForm()}})),u.createElement("div",{className:f().main},u.createElement(s.Z,{dataSource:this.state.articleData},u.createElement(S,{title:"文章名称",dataIndex:"articleTitle",key:"articleTitle"}),u.createElement(S,{title:"点击量",dataIndex:"hits",key:"hits"}),u.createElement(S,{title:"创建时间",dataIndex:"created",key:"created",render:function(e,t){return u.createElement("p",null," ",new Date(t.created).toLocaleDateString()," ")}}),u.createElement(S,{title:"最后修改时间",dataIndex:"lastModified",key:"lastModified",render:function(e,t){return u.createElement("p",null," ",new Date(t.lastModified).toLocaleDateString()," ")}}),u.createElement(S,{title:"上线状态",key:"online",render:function(t,n){return u.createElement("span",{onClick:function(){e.changeOnlineStatus(n._id,n.online)}},n.online?u.createElement("a",null,"已上线"):u.createElement("a",null,"未上线"))}}),u.createElement(S,{title:"标签",key:"tag",render:function(e,t){return u.createElement(o.Z,{color:"blue",key:t.tag},t.tag)}}),u.createElement(S,{title:"操作",key:"action",render:function(t,n){return u.createElement(i.Z,{size:"middle"},u.createElement(d.rU,{to:"/admin/message/".concat(n._id)},"管理留言"),u.createElement(d.rU,{to:"/admin/article/edit/".concat(n._id)},"编辑文章"),u.createElement("a",{onClick:function(){console.log(n),e.setForm({articleTitle:n.articleTitle,articleTag:n.tag,articleId:n._id})}},"修改"),u.createElement("a",{onClick:function(){return e.deleteArticle(n._id)}},"删除"))}})),u.createElement(r.Z,{title:"文章",visible:this.state.formVisible,onOk:this.updateArticle,onCancel:function(){return e.setState({formVisible:!1})}},u.createElement(a.Z,{className:f().modalInput,placeholder:"文章名称",value:this.state.articleTitle,onChange:function(t){e.setState({articleTitle:t.target.value})}}),u.createElement(a.Z,{className:f().modalInput,placeholder:"分类",value:this.state.articleTag,onChange:function(t){e.setState({articleTag:t.target.value})}}))))}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),k}(u.Component)},2445:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w}),n(160);var r=n(1577),a=(n(6669),n(5026)),i=n(7294),o=n(6974),l=n(8905),c=n.n(l),s=n(2104),u=n(1876),d=n(6095),m=n.n(d),f=m().import("formats/code-block");f.className="hljs",m().register(f,!0);const p=m();var g=n(7969),h=n.n(g),y=n(2145),v=n(8783);function b(e,t,n,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){b(i,r,a,o,l,"next",e)}function l(e){b(i,r,a,o,l,"throw",e)}o(void 0)}))}}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(){var e=(0,o.UO)(),t=A((0,i.useState)({}),2),n=t[0],l=t[1],u=A((0,i.useState)(),2),d=u[0],m=u[1],f=A((0,i.useState)(),2),g=f[0],h=f[1];return(0,i.useEffect)(E(regeneratorRuntime.mark((function t(){var n,r,a,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("all formats",p.imports),i=e.articleId,h(i),console.log("articleId:",i),a=new p("#admin-editor-content",k),console.log("QuillEditor created:",a),t.next=8,T(i);case 8:n=t.sent,r=n.data,l(r),console.log("Editor Context:",r),""!==r.content&&(console.log("parsing:",r.content),o=JSON.parse(r.content),console.log("setting content",o),a.setContents(o)),m(a);case 14:case"end":return t.stop()}}),t)}))),[]),i.createElement("div",{className:c().container},i.createElement("div",{className:c().header},i.createElement("div",{className:c().left},i.createElement("h1",null," ",n.articleTitle," ")),i.createElement("div",{className:c().right},i.createElement(r.Z,{icon:i.createElement(s.Z,null),onClick:function(){var e=d.getContents(),t=d.getText();console.log("content got:",e,t,g),function(e,t,n){return I.apply(this,arguments)}(g,JSON.stringify(e),t).then((function(){a.ZP.success("保存成功")}))}}))),i.createElement("div",{className:c().editor},i.createElement("div",{id:"admin-editor-toolbar",className:c().toolbar}),i.createElement("div",{id:"admin-editor-content",className:c().content})))}p.register("modules/imageResize",h()),p.register("modules/imageUploader",y.Z);var k={modules:{syntax:{highlight:function(e){return console.log("****",e),v.Z.highlightAuto(e).value}},toolbar:[[{font:[]}],[{header:[1,2,3,4,!1]}],["bold","italic","underline"],["image","code-block"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],[{align:[]}],["clean"]],imageResize:{modules:["Resize","DisplaySize"]},imageUploader:{upload:function(e){return new Promise((function(t,n){var r=new FormData;r.append("image",e),u.Z.post("/admin/asset",r,{params:{type:"articleImage"}}).then((function(e){console.log(e),0!==e.code?n(e.message):t(e.data.url)}))}))}}},scrollingContainer:".ql-editor",theme:"snow"};function T(e){return Z.apply(this,arguments)}function Z(){return(Z=E(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("in getArticle, articleId",t),e.abrupt("return",u.Z.get("/admin/articleEdit",{params:{articleId:t}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=E(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(r.length<200?r:r.slice(0,200)).replace(/\n/g," "),e.abrupt("return",u.Z.put("admin/article",{articleId:t,content:n,lastModified:(new Date).getTime(),summary:a}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1876:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m}),n(6669);var r=n(5026),a=n(9669),i=n.n(a),o=n(8237),l=n.n(o),c=n(9047),s=n(4628),u={baseURL:l().server.prodURL+":"+String(l().server.apiPort),timeout:"8000"},d=i().create({baseURL:u.baseURL,timeout:u.timeout});d.interceptors.request.use((function(e){return e.headers.authToken=c.Z.getState().adminLogin.token,e.headers.username=c.Z.getState().adminLogin.username,e}),(function(e){console.log("[herald] request failed:",e)})),d.interceptors.response.use((function(e){return 0!==e.data.code?(r.ZP.warning(e.data.message),1===e.data.code?r.ZP.error(e.data.message):2===e.data.code|3===e.data.code&&c.Z.dispatch((0,s.av)({username:"",needLogin:!0,token:""})),Promise.reject(e.data.message)):e.data}),(function(e){return console.log("[herald] response failed:",e),Promise.reject(e)}));const m=d},4259:(e,t,n)=>{e.exports={container:"client-components-admin-article-Article_container-qAdW",header:"client-components-admin-article-Article_header-JSAU",newArticle:"client-components-admin-article-Article_newArticle-NQ4i",modalInput:"client-components-admin-article-Article_modalInput-Y_G6",main:"client-components-admin-article-Article_main-FfI7"};var r=n(4783)(e.id,{esModule:!1,locals:!0});e.hot.dispose(r)},8905:(e,t,n)=>{e.exports={container:"client-components-admin-article-articleEditor-ArticleEditor_container-dKIu",header:"client-components-admin-article-articleEditor-ArticleEditor_header-VS9M",left:"client-components-admin-article-articleEditor-ArticleEditor_left-w3bW",right:"client-components-admin-article-articleEditor-ArticleEditor_right-vyD1",editor:"client-components-admin-article-articleEditor-ArticleEditor_editor-qq3X",toolbar:"client-components-admin-article-articleEditor-ArticleEditor_toolbar-z3MC",content:"client-components-admin-article-articleEditor-ArticleEditor_content-JZa8"};var r=n(4783)(e.id,{esModule:!1,locals:!0});e.hot.dispose(r)}}]);